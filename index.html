<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Verificamex - CÃ¡mara Frontal</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .camera-info {
            background: #e7f3ff;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            font-size: 14px;
        }
        
        .camera-info p {
            margin: 5px 0;
        }
        
        .step-indicator {
            background: #6c757d;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .selfie-video {
            transform: scaleX(-1); /* Efecto espejo para selfie */
        }
        
        .camera-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .camera-button {
            flex: 1;
            min-width: 140px;
        }
        
        @media (max-width: 768px) {
            .camera-buttons {
                flex-direction: column;
            }
            
            .camera-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± Demo Verificamex</h1>
        <p class="warning">âš ï¸ SOLO PARA DESARROLLO - Token visible</p>
        
        <div class="camera-info">
            <p><strong>ğŸ“¸ Modo cÃ¡mara frontal Ãºnica:</strong></p>
            <p>â€¢ Usamos solo la cÃ¡mara frontal para todos los pasos</p>
            <p>â€¢ Selfie se muestra en espejo (mÃ¡s natural)</p>
            <p>â€¢ INE se captura normalmente</p>
            <p>â€¢ <span id="step-indicator">Paso 1 de 4</span></p>
        </div>
        
        <div class="debug-panel">
            <h3>ğŸ”§ Controles de CÃ¡mara</h3>
            <div class="debug-buttons">
                <button onclick="restartCamera()">ğŸ”„ Reiniciar CÃ¡mara</button>
                <button onclick="testSimpleEndpoint()">ğŸ” Probar OCR</button>
                <button onclick="testAllEndpoints()">ğŸ”„ Probar Todo</button>
                <button onclick="console.log('Fotos:', photos)">ğŸ“Š Ver Fotos</button>
            </div>
        </div>
        
        <div class="steps">
            <!-- Paso 1: INE Frontal -->
            <div class="step active" id="step1">
                <h2>ğŸ“„ Paso 1: INE Frontal</h2>
                <p><small>Apunta la cÃ¡mara frontal al INE</small></p>
                
                <div class="camera-container">
                    <video id="video1" autoplay playsinline></video>
                    
                    <div class="camera-buttons">
                        <button onclick="capturePhoto(1)" class="camera-button" style="background: #28a745;">
                            ğŸ“¸ Capturar INE Frontal
                        </button>
                        <button onclick="useTestImage(1)" class="camera-button" style="background: #17a2b8;">
                            ğŸ§ª Usar Imagen de Prueba
                        </button>
                        <button onclick="skipStep(1)" class="camera-button" style="background: #6c757d;">
                            â­ï¸ Saltar INE Frontal
                        </button>
                    </div>
                </div>
                
                <div class="preview" id="preview1"></div>
            </div>
            
            <!-- Paso 2: INE Trasero -->
            <div class="step" id="step2">
                <h2>ğŸ“„ Paso 2: INE Trasero (Opcional)</h2>
                <p><small>Voltea el INE y captura la parte trasera</small></p>
                
                <div class="camera-container">
                    <video id="video2" autoplay playsinline></video>
                    
                    <div class="camera-buttons">
                        <button onclick="capturePhoto(2)" class="camera-button" style="background: #28a745;">
                            ğŸ“¸ Capturar INE Trasero
                        </button>
                        <button onclick="useTestImage(2)" class="camera-button" style="background: #17a2b8;">
                            ğŸ§ª Usar Imagen de Prueba
                        </button>
                        <button onclick="skipStep(2)" class="camera-button" style="background: #6c757d;">
                            â­ï¸ Saltar INE Trasero
                        </button>
                    </div>
                </div>
                
                <div class="preview" id="preview2"></div>
            </div>
            
            <!-- Paso 3: Selfie -->
            <div class="step" id="step3">
                <h2>ğŸ˜Š Paso 3: Selfie</h2>
                <p><small>Mira a la cÃ¡mara frontal y sonrÃ­e</small></p>
                
                <div class="camera-container">
                    <video id="video3" autoplay playsinline class="selfie-video"></video>
                    
                    <div class="camera-buttons">
                        <button onclick="capturePhoto(3)" class="camera-button" style="background: #28a745;">
                            ğŸ˜Š Capturar Selfie
                        </button>
                        <button onclick="useTestImage(3)" class="camera-button" style="background: #17a2b8;">
                            ğŸ§ª Usar Selfie de Prueba
                        </button>
                        <button onclick="skipStep(3)" class="camera-button" style="background: #6c757d;">
                            â­ï¸ Saltar Selfie
                        </button>
                    </div>
                </div>
                
                <div class="preview" id="preview3"></div>
            </div>
            
            <!-- Paso 4: Validar -->
            <div class="step" id="step4">
                <h2>âœ… Paso 4: Validar</h2>
                <p><small>EnvÃ­a las fotos a Verificamex para validaciÃ³n</small></p>
                
                <div class="camera-buttons">
                    <button onclick="validateIdentity()" class="validate-btn" style="background: #007bff;">
                        ğŸš€ Validar con Verificamex
                    </button>
                    <button onclick="tryComparison()" style="background: #ffc107; color: #000;">
                        ğŸ˜Š Solo ComparaciÃ³n Facial
                    </button>
                    <button onclick="resetDemo()" style="background: #6c757d;">
                        ğŸ”„ Comenzar de Nuevo
                    </button>
                </div>
                
                <div id="loading" style="display:none;">
                    <div class="spinner"></div>
                    <p>Procesando con Verificamex...</p>
                </div>
                
                <div id="result"></div>
            </div>
        </div>
        
        <div class="token-info">
            <small>ğŸ” Token activo: <span id="token-preview">****************</span></small>
            <br>
            <small>ğŸ“¸ CÃ¡mara: <span id="camera-status">Frontal</span></small>
            <br>
            <small>ğŸ”„ Ãšltima acciÃ³n: <span id="last-action">Esperando...</span></small>
        </div>
    </div>
    
    <script src="camera.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Actualizar estado de cÃ¡mara
        function updateCameraStatus(status) {
            const statusEl = document.getElementById('camera-status');
            if (statusEl) statusEl.textContent = status;
        }
        
        // Actualizar Ãºltima acciÃ³n
        function updateLastAction(action) {
            const actionEl = document.getElementById('last-action');
            if (actionEl) actionEl.textContent = action;
        }
        
        // Sobrescribir funciones para tracking
        const originalCapturePhoto = window.capturePhoto;
        window.capturePhoto = function(stepNumber) {
            const stepNames = ['', 'INE Frontal', 'INE Trasero', 'Selfie'];
            updateLastAction(`Capturando ${stepNames[stepNumber]}`);
            return originalCapturePhoto(stepNumber);
        };
        
        const originalUseTestImage = window.useTestImage;
        window.useTestImage = function(stepNumber) {
            updateLastAction('Usando imagen de prueba');
            return originalUseTestImage(stepNumber);
        };
        
        const originalInitFrontCamera = window.initFrontCamera;
        window.initFrontCamera = async function() {
            updateLastAction('Iniciando cÃ¡mara...');
            const result = await originalInitFrontCamera();
            if (result) {
                updateCameraStatus('Frontal âœ…');
                updateLastAction('CÃ¡mara lista');
            } else {
                updateCameraStatus('Frontal âŒ');
                updateLastAction('Error en cÃ¡mara');
            }
            return result;
        };
        
        // InicializaciÃ³n cuando cargue la pÃ¡gina
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar token parcial
            const tokenPreview = document.getElementById('token-preview');
            if (typeof VERIFICAMEX_TOKEN !== 'undefined' && VERIFICAMEX_TOKEN) {
                const visiblePart = VERIFICAMEX_TOKEN.substring(0, 10);
                tokenPreview.textContent = visiblePart + '...';
            }
            
            // Iniciar cÃ¡mara frontal
            setTimeout(() => {
                initFrontCamera();
            }, 500);
        });
    </script>
</body>
</html>